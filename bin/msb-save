#!/usr/bin/env node
var argv = require('minimist')(process.argv.slice(2), {
  default: {
    by: 'topics.to',
    ext: 'json'
  }
});

var fs = require('fs');
var path = require('path');
var _ = require('lodash');

process
.stdin
.pipe(require('split')(JSON.parse))
.on('data', function(obj) {
  var filename = _.get(obj, argv.by).replace(/\:/g, '_') + '.' + argv.ext;
  fs.appendFileSync(path.join(argv._[0] || '.', filename), JSON.stringify(obj, null, '  '));
})
.on('error', function(err) {
  throw err;
});
